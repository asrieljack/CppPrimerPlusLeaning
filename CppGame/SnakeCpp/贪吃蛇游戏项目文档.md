# 贪吃蛇游戏项目文档

## 项目概述

这是一个基于C++和EasyX图形库开发的经典贪吃蛇游戏。游戏具有完整的贪吃蛇移动、食物生成、碰撞检测、积分系统和游戏状态管理功能。

## 项目结构

### 文件结构

```
project/
├── main.cpp                 # 主程序文件
├── headers/
│   └── compatibility.h     # 兼容性头文件
└── README.md               # 项目说明文档
```

### 依赖库

- **EasyX**：图形界面库
- **Windows API**：窗口管理和输入处理
- **C++标准库**：向量、随机数、时间等

## 类设计详解

### 1. Sprite类（精灵基类）

**职责**：所有游戏对象的基类，提供基本的位置和绘制功能

```cpp
class Sprite {
protected:
    int m_x;           // X坐标
    int m_y;           // Y坐标
    COLORREF m_color;  // 颜色值
};
```

**主要方法**：

- `Draw()`: 虚方法，绘制精灵
- `moveBy(dx, dy)`: 移动精灵
- `collision()`: 碰撞检测
- `getX()/getY()`: 获取坐标

### 2. Snake类（蛇类）

**继承关系**：继承自Sprite类

**核心属性**：

```cpp
std::vector<Sprite> nodes;  // 蛇身节点数组
int dir;                    // 移动方向（使用VK_常量）
```

**关键方法**：

#### 移动系统

- `bodyMove()`: 蛇身移动逻辑
  - 从尾部向前逐节移动
  - 根据方向移动头部
  - 支持四个方向移动（上下左右）

#### 碰撞检测

- `isHitWall()`: 墙壁碰撞检测
  - 检测坐标是否超出窗口边界（640×480）
- `isHitSelf()`: 自撞检测
  - 检测头部是否与身体其他部分碰撞
  - 长度≤3时跳过检测（不可能自撞）

#### 成长系统

- `increaseMent()`: 增加蛇身长度
- `getLength()`: 获取当前长度（用于积分计算）

### 3. Food类（食物类）

**继承关系**：继承自Sprite类

**核心功能**：

- `changePos()`: 随机生成食物位置
  - X坐标：0-63格（每格10像素）
  - Y坐标：0-47格（每格10像素）
- `Draw()`: 绘制椭圆形食物

### 4. GameScene类（游戏场景类）

**职责**：游戏主控制器，管理游戏流程和状态

**核心属性**：

```cpp
Snake snake;      // 蛇对象
Food food;        // 食物对象
bool gameOver;    // 游戏结束标志
int score;        // 当前积分
int baseScore;    // 基础分数（初始长度）
```

## 游戏流程

### 1. 初始化阶段

```cpp
initgraph(640, 480);    // 创建640×480窗口
srand(time(nullptr));   // 初始化随机数种子
GameScene scene;        // 创建游戏场景
```

### 2. 主游戏循环

```cpp
while (true) {
    scene.run();        // 执行游戏逻辑
    Sleep(50);          // 50ms刷新率（20FPS）
}
```

### 3. 游戏运行流程（run方法）

1. **状态检查**：检测gameOver状态
2. **画面绘制**：使用双缓冲绘制
3. **蛇身移动**：调用bodyMove()
4. **碰撞检测**：墙壁和自撞检测
5. **吃食检测**：检测蛇头与食物碰撞
6. **输入处理**：处理键盘输入

### 4. 输入处理系统

- **方向控制**：上下左右箭头键
- **防反向移动**：不能直接反向移动
- **重新开始**：游戏结束后按R键重启

## 积分系统

### 计分规则

- **基础长度**：3节（初始长度）
- **计分公式**：`分数 = (当前长度 - 基础长度) × 10`
- **显示位置**：窗口左上角实时显示
- **游戏结束**：显示最终得分

### 示例

- 初始状态：3节 → 0分
- 吃1个食物：4节 → 10分
- 吃2个食物：5节 → 20分
- 吃5个食物：8节 → 50分

## 碰撞系统

### 1. 墙壁碰撞

```cpp
// 窗口边界：0 ≤ x < 640, 0 ≤ y < 480
bool isHitWall = (headX < 0 || headX >= 640 || headY < 0 || headY >= 480);
```

### 2. 自撞碰撞

```cpp
// 从第4节开始检测（前3节不可能自撞）
for (size_t i = 3; i < nodes.size(); i++) {
    if (nodes[i]与头部坐标相同) return true;
}
```

### 3. 食物碰撞

```cpp
// 检测蛇头与食物坐标是否相同
bool isEatFood = (snake.nodes[0]与food坐标相同);
```

## 游戏状态管理

### 运行状态

- 正常游戏：绘制蛇、食物、分数
- 实时响应玩家输入
- 持续检测碰撞

### 结束状态

- 显示"Game Over!"
- 显示最终得分
- 提示按R键重新开始
- 等待玩家输入

## 技术特点

### 1. 面向对象设计

- 合理的类继承关系
- 封装游戏逻辑
- 易于扩展和维护

### 2. 图形渲染

- 使用EasyX图形库
- 双缓冲绘制避免闪烁
- 10×10像素网格系统

### 3. 游戏逻辑

- 稳定的20FPS游戏循环
- 精确的碰撞检测
- 流畅的输入响应

## 编译和运行

### 环境要求

- Windows操作系统
- C++编译器（支持C++11）
- EasyX图形库

### 编译命令

```bash
g++ main.cpp -o snake.exe -lgdi32 -lole32
```

### 运行说明

1. 确保EasyX库正确安装
2. 编译生成可执行文件
3. 直接运行程序即可开始游戏

## 游戏操作指南

### 控制方式

- **↑↓←→**：控制蛇移动方向
- **R键**：游戏结束后重新开始

### 游戏目标

- 尽可能多吃食物
- 避免撞墙和撞到自己
- 获得更高分数

## 扩展建议

1. **难度系统**：随分数增加移动速度
2. **关卡设计**：添加障碍物或特殊食物
3. **音效系统**：添加吃食物和碰撞音效
4. **存档功能**：保存最高分记录
5. **多人模式**：添加双人对战功能

---

*项目使用C++和EasyX图形库开发，适合学习游戏编程和面向对象设计*
